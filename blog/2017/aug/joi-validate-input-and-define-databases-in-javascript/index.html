<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Joi: validate input and define databases in JavaScript - Bruno Luiz Silva</title><meta name=description content="As the saying goes: never trust user input. People coming from PHP and Java have many validation libraries available. But what about JavaScript? There are some options, but none seems more interesting than Joi."><meta name=author content><link rel=canonical href=https://brunoluiz.net/blog/2017/aug/joi-validate-input-and-define-databases-in-javascript/><link href=https://brunoluiz.net/css/stylesheet.min.7e165bbf11c7210826cf9e8dd166f498fd4030911676dc9dc64762515c11ce38.css integrity="sha256-fhZbvxHHIQgmz56N0Wb0mP1AMJEWdtydxkdiUVwRzjg=" rel="preload stylesheet" as=style><link rel=apple-touch-icon href=https://brunoluiz.net/apple-touch-icon.png><link rel=icon href=https://brunoluiz.net/favicon.ico><meta name=generator content="Hugo 0.75.1"><meta property="og:title" content="Joi: validate input and define databases in JavaScript"><meta property="og:description" content="As the saying goes: never trust user input. People coming from PHP and Java have many validation libraries available. But what about JavaScript? There are some options, but none seems more interesting than Joi."><meta property="og:type" content="article"><meta property="og:url" content="https://brunoluiz.net/blog/2017/aug/joi-validate-input-and-define-databases-in-javascript/"><meta property="og:image" content="https://brunoluiz.net/blog/2017/aug/joi-validate-input-and-define-databases-in-javascript/cover.jpg"><meta property="article:published_time" content="2017-08-30T19:44:37+00:00"><meta property="article:modified_time" content="2017-08-30T19:44:37+00:00"><meta property="og:site_name" content="Bruno Luiz Silva"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://brunoluiz.net/blog/2017/aug/joi-validate-input-and-define-databases-in-javascript/cover.jpg"><meta name=twitter:title content="Joi: validate input and define databases in JavaScript"><meta name=twitter:description content="As the saying goes: never trust user input. People coming from PHP and Java have many validation libraries available. But what about JavaScript? There are some options, but none seems more interesting than Joi."><meta itemprop=name content="Joi: validate input and define databases in JavaScript"><meta itemprop=description content="As the saying goes: never trust user input. People coming from PHP and Java have many validation libraries available. But what about JavaScript? There are some options, but none seems more interesting than Joi."><meta itemprop=datePublished content="2017-08-30T19:44:37+00:00"><meta itemprop=dateModified content="2017-08-30T19:44:37+00:00"><meta itemprop=wordCount content="1192"><meta itemprop=image content="https://brunoluiz.net/blog/2017/aug/joi-validate-input-and-define-databases-in-javascript/cover.jpg"><meta itemprop=keywords content></head><body class=single id=top><script>if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><header class=header><nav class=nav><p class=logo><a href=https://brunoluiz.net>Bruno Luiz Silva</a></p><ul class=menu id=menu onscroll=menu_on_scroll()></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Joi: validate input and define databases in JavaScript</h1><div class=post-meta><time>August 30, 2017</time>&nbsp;Â·&nbsp;6 min</div></header><div class=post-content><p><img src=cover.jpg alt="Photo by Rayi Christian Wicaksono"></p><p>As the saying goes: <em>never trust user input</em>. People coming from PHP and Java have many validation libraries available. But what about JavaScript? There are some options, but none seems more interesting than Joi.</p><p><a href=https://github.com/hapijs/joi>Joi</a> is maintained by <a href=https://hapijs.com/>Hapi.js project</a>. Even though hapi.js is a web framework by itself, Joi is independent and can be used in any type of node project. This is great for people using express or restify, for example.</p><p>What makes it even more interesting is that, besides user validation, it can be used to define database schemas as well. This post will introduce a quick start guide, with some usage cases and general tweaks.</p><h2 id=how-to-use-it>How to use it?</h2><p>First things first: it has to be installed on the project. Considering an already initiated node project, the command to install it is: npm install joi. After being installed, a schema is required to use it, such as the file <code>rating-schema.js</code> below:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// rating-schema.js
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Joi</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;joi&#39;</span>)

<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>object</span>().<span style=color:#a6e22e>keys</span>({
  <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>string</span>(),
  <span style=color:#a6e22e>rating</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>number</span>()
    .<span style=color:#a6e22e>integer</span>()
    .<span style=color:#a6e22e>min</span>(<span style=color:#ae81ff>1</span>)
    .<span style=color:#a6e22e>max</span>(<span style=color:#ae81ff>5</span>)
    .<span style=color:#66d9ef>default</span>(<span style=color:#ae81ff>5</span>),
  <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>string</span>()
    .<span style=color:#a6e22e>email</span>()
    .<span style=color:#a6e22e>required</span>()
})
</code></pre></div><p>This defines a model where an username, a rating (from 1 to 5) and an email (which is a required field) are expected. This is a simple example, but there are way more validation options, which can be found on the <a href=https://github.com/hapijs/joi/blob/v10.6.0/API.md>API reference</a>. To use the defined schema, consider a file called <code>rating-test.js</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// rating-test.js
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>schema</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./rating-schema&#39;</span>)

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>validate</span>({
  <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;brunoluiz&#39;</span>,
  <span style=color:#a6e22e>rating</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5</span>,
  <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;contact@brunoluiz.net&#39;</span>
})
<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>result</span>) <span style=color:#75715e>// result.error will be null
</span><span style=color:#75715e></span>
<span style=color:#75715e>// result.error will show an error due to missing e-mail
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>resultWithError</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>validate</span>({
  <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;brunoluiz&#39;</span>,
  <span style=color:#a6e22e>rating</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5</span>
})
<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>resultWithError</span>) <span style=color:#75715e>// result.error will have an error message
</span></code></pre></div><p><a href=https://github.com/hapijs/joi/blob/v10.6.0/API.md#errors>More about Joi errors</a></p><h2 id=real-project-usage>Real project usage</h2><h3 id=validation-middleware>Validation middleware</h3><p>In a real project, Joi can be used on a middleware layer. On <a href=http://expressjs.com><code>express</code></a>, for example, this can be done using:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// ratings-validor.js
</span><span style=color:#75715e></span>
<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>next</span>) =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ratings</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Ratings</span>.<span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>validate</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>)
  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>ratings</span>.<span style=color:#a6e22e>error</span>) {
    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>next</span>(<span style=color:#a6e22e>ratings</span>.<span style=color:#a6e22e>error</span>)
  }
  <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>parsed</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ratings</span>.<span style=color:#a6e22e>value</span>
  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>next</span>()
}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// ....
</span><span style=color:#75715e>// routes.js
</span><span style=color:#75715e></span>
<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#39;/ratings&#39;</span>, <span style=color:#a6e22e>ratingsValidator</span>, <span style=color:#a6e22e>ratingsCreateController</span>)
</code></pre></div><p>In this case, if the <code>ratingsValidator</code> returns an error due to validation, express will stop the request before even reaching the controller.</p><h3 id=database-schema-mongodb-and-dynamodb>Database schema (MongoDB and DynamoDB)</h3><p>Some tools can use it to define their database schema (keep in mind that Joi is not an ORM). For MongoDB, <code>mongoose</code> can be used together with <a href=https://github.com/yoitsro/joigoose><code>joigoose</code></a>, which easily converts a Joi schema. For example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// rating.js
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mongoose</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;mongoose&#39;</span>)
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>joigoose</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;joigoose&#39;</span>)(<span style=color:#a6e22e>mongoose</span>)

<span style=color:#75715e>// Require the &#39;ratings&#39; schema
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>schema</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./rating-schema&#39;</span>)

<span style=color:#75715e>// Convert joi to mongoose schema
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mongooseSchema</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>joigoose</span>.<span style=color:#a6e22e>convert</span>(<span style=color:#a6e22e>schema</span>)

<span style=color:#75715e>// Modify some fields with database specific instructions
</span><span style=color:#75715e></span><span style=color:#a6e22e>mongooseSchema</span>.<span style=color:#a6e22e>email</span>.<span style=color:#a6e22e>unique</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>

<span style=color:#75715e>// Add fields which don&#39;t make sense on the schema validator
</span><span style=color:#75715e></span><span style=color:#a6e22e>mongooseSchema</span>.<span style=color:#a6e22e>updatedAt</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> Date, <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span> Date.<span style=color:#a6e22e>now</span> }
<span style=color:#a6e22e>mongooseSchema</span>.<span style=color:#a6e22e>createdAt</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> Date, <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span> Date.<span style=color:#a6e22e>now</span> }

<span style=color:#75715e>// Define mongoose model
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Ratings</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mongoose</span>.<span style=color:#a6e22e>model</span>(<span style=color:#e6db74>&#39;Ratings&#39;</span>, <span style=color:#a6e22e>mongooseSchema</span>)

<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Ratings</span>
</code></pre></div><p>Through <a href=https://github.com/ryanfitz/vogels><code>vogels</code></a>, the same can be done in projects using DynamoDB. By default, it accepts Joi as its schema definition. The following example is based on <code>vogels</code> documentation:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// blog-post-schema.js
</span><span style=color:#75715e></span>
<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
  <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>string</span>().<span style=color:#a6e22e>email</span>(),
  <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>string</span>(),
  <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>binary</span>(),
  <span style=color:#a6e22e>tags</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vogels</span>.<span style=color:#a6e22e>types</span>.<span style=color:#a6e22e>stringSet</span>()
}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// blog-post.js
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>schema</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./blog-post-schema.js&#39;</span>)

<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vogels</span>.<span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;BlogPost&#39;</span>, {
  <span style=color:#a6e22e>hashKey</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;email&#39;</span>,
  <span style=color:#a6e22e>rangeKey</span><span style=color:#f92672>:</span> <span style=color:#960050;background-color:#1e0010>â</span><span style=color:#a6e22e>title</span><span style=color:#960050;background-color:#1e0010>â</span>,
  <span style=color:#a6e22e>schema</span>
})
</code></pre></div><h3 id=exchangeability-for-front-end-validation>Exchangeability for front-end validation</h3><p>Some developers prefer to define the schema once and then use everywhere, including on browsers. Today <a href=https://github.com/hapijs/joi/#browsers>Joi doesn&rsquo;t support browser usage</a>, but a package called <a href=https://github.com/jeffbski/joi-browser><code>joi-browser</code> does this job</a>, enabling the usage of exactly the same schema on the front-end as well.</p><h2 id=useful-tweaks>Useful tweaks</h2><p><img src=tweaking.jpeg alt="Photo by chuttersnap on Unsplash"></p><h3 id=1-disable-joi-number-convert>#1 Disable Joi number() convert</h3><p>By default, Joi allows users to pass numbers formatted as strings, in cases of number() fields. This is specially bad if the validate() result is only used to check if there was an error, but not for it&rsquo;s value field. To solve this, there are two possible solutions</p><ol><li><p>On <code>schema.validate(value)</code>, an extra parameter can be passed to disable it, as: <code>schema.validate(value, { convert: false })</code></p></li><li><p>Put a <code>strict()</code> at the end of the desired number field, as: <code>Joi.number().strict()</code></p></li></ol><p>Both of them are quite annoying, because either all fields or all function calls require a specific config. One way to solve this is by extending Joiâ¦</p><h3 id=2-extend-joi-defaults>#2 Extend Joi defaults</h3><p>In cases such as the above, or for new field types, or even when the behavior of a default field has to be changed, <code>Joi.extend()</code> can be an option.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// joi.js
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Joi</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;joi&#39;</span>)

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ukzip</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>/^[A-Z]{1,2}[0-9]{1,2}[A-Z]{0,1} ?[0-9][A-Z]{2}$/i</span>

<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>extend</span>(
  {
    <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;number&#39;</span>,
    <span style=color:#a6e22e>base</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>number</span>().<span style=color:#a6e22e>strict</span>()
  },
  {
    <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;zipcode&#39;</span>,
    <span style=color:#a6e22e>base</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>regex</span>(<span style=color:#a6e22e>ukzip</span>).<span style=color:#a6e22e>description</span>(<span style=color:#e6db74>&#39;UK Zipcode&#39;</span>)
  }
)
</code></pre></div><p>When using Joi through this file, all number fields will be on the strict mode â which solves the issue of applying tweak #1 everywhere â and a <code>zipcode()</code> validator is created, based on a pre-defined regex.</p><p>More rules can be added and, actually, the Joi API enables <a href=https://github.com/hapijs/joi/blob/v10.6.0/API.md#extendextension>much more customisation</a> on <code>Joi.extend</code>.</p><h3 id=3-create-default-fields>#3 Create default fields</h3><p>In some projects, a lot of models will have some default fields, such as an <code>extensionAttributes</code>, where custom vendor data will be put into (as Magento already does) or <code>updatedAt</code>. In these cases, the <code>Joi.object</code> can be extended to include default fields:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// joi.js
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Joi</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;joi&#39;</span>)

<span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>extend</span>({
  <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;object&#39;</span>,
  <span style=color:#a6e22e>base</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>object</span>().<span style=color:#a6e22e>keys</span>({
    <span style=color:#a6e22e>extensionAttributes</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>object</span>(),
    <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>date</span>().<span style=color:#66d9ef>default</span>(Date.<span style=color:#a6e22e>now</span>)
  })
})
</code></pre></div><h3 id=4-show-all-validation-errors>#4 Show all validation errors</h3><p>Usually Joi validation dies on the first error, returning on it&rsquo;s message which field failed. This is an issue when an input have many fields with problems. The user will have to do many requests to discover all problematic fields. To fix this issue, the following option can be added on the function call:</p><p><code>const result = schema.validate(value, { abortEarly: false })</code></p><p>With this config, if an error occurs, the <code>result.error</code> will return all validation failures.</p><h3 id=5-built-in-joi-conditional-validations>#5 Built-in Joi conditional validations</h3><p>If a field depends on values from another field, the conditional when() can be used.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// joi-from-doc.js
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Joi</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;joi&#39;</span>)

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>schema</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>object</span>().<span style=color:#a6e22e>keys</span>({
  <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>any</span>()
    .<span style=color:#a6e22e>valid</span>(<span style=color:#e6db74>&#39;x&#39;</span>)
    .<span style=color:#a6e22e>when</span>(<span style=color:#e6db74>&#39;b&#39;</span>, {
      <span style=color:#a6e22e>is</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5</span>,
      <span style=color:#a6e22e>then</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>valid</span>(<span style=color:#e6db74>&#39;y&#39;</span>),
      <span style=color:#a6e22e>otherwise</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>valid</span>(<span style=color:#e6db74>&#39;z&#39;</span>)
    }),
  <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Joi</span>.<span style=color:#a6e22e>any</span>()
})

<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>validate</span>({ <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;x&#39;</span> }).<span style=color:#a6e22e>error</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>null</span>) <span style=color:#75715e>// valid
</span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>validate</span>({ <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;z&#39;</span> }).<span style=color:#a6e22e>error</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>null</span>) <span style=color:#75715e>// valid
</span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>validate</span>({ <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;z&#39;</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span> }).<span style=color:#a6e22e>error</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>null</span>) <span style=color:#75715e>// valid
</span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>validate</span>({ <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;y&#39;</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span> }).<span style=color:#a6e22e>error</span> <span style=color:#f92672>!==</span> <span style=color:#66d9ef>null</span>) <span style=color:#75715e>// invalid
</span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>validate</span>({ <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;y&#39;</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5</span> }).<span style=color:#a6e22e>error</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>null</span>) <span style=color:#75715e>// valid
</span></code></pre></div><p>In this case, the field <code>a</code> accepts the values <code>x, y, z</code>. But, to accept <code>y</code> as a value, the field b have to be equals 5, otherwise only <code>x</code> and <code>z</code> will be accepted.</p><p>Of course, this is a simple and fictitious conditional validation, but it is quite useful in cases where some field requires a specific validator when some other had a specific input.</p><h2 id=are-you-ready-to-use-it>Are you ready to use it?</h2><p>I hope this post convinced you to use some validation tool such as Joi, instead of validating everything by hand (or not validating at all). But, if you are using it already: do you know any other cool trick or tweak? Let me know in the comments section below.</p><h2 id=references>References</h2><ul><li><p>Joi repo: <a href=https://github.com/hapijs/joi>https://github.com/hapijs/joi</a></p></li><li><p>Joi API Reference: <a href=https://github.com/hapijs/joi/blob/v10.6.0/API.md>https://github.com/hapijs/joi/blob/v10.6.0/API.md</a></p></li><li><p>Joigoose repo: <a href=https://github.com/yoitsro/joigoose>https://github.com/yoitsro/joigoose</a></p></li><li><p>Joi-browser repo: <a href=https://github.com/jeffbski/joi-browser>https://github.com/jeffbski/joi-browser</a></p></li><li><p>Mongoose website: <a href=http://mongoosejs.com>http://mongoosejs.com</a></p></li><li><p>Vogels repo: <a href=https://github.com/ryanfitz/vogels>https://github.com/ryanfitz/vogels</a></p></li></ul></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://brunoluiz.net>Bruno Luiz Silva</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugoï¸ï¸</a>ï¸</span>
<span>&#183;</span>
<span>Themeï¸ <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top"><button class=top-link id=top-link type=button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button></a>
<script src=https://brunoluiz.net/js/highlight.min.min.e7afc2928c0925d65c4732dfebe147014d91299a98e819e4b42f25c4fa68e91c.js integrity="sha256-56/CkowJJdZcRzLf6+FHAU2RKZqY6BnktC8lxPpo6Rw="></script><script>hljs.initHighlightingOnLoad();</script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();document.querySelector(this.getAttribute("href")).scrollIntoView({behavior:"smooth"});});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script></body></html>