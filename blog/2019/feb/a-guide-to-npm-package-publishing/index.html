<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>A guide on npm package publishing - Bruno Luiz Silva</title><meta name=description content="If you are not new in the JavaScript world, you might have already heard about npm. It is a package manager which lets developers easily add dependencies to projects, as npm install hello-world. But, have you ever asked, How do I create and publish my own packages"><meta name=author content><link rel=canonical href=https://brunoluiz.net/blog/2019/feb/a-guide-to-npm-package-publishing/><link href=https://brunoluiz.net/css/stylesheet.min.7d95f5690822722ec3b47b3bfdf223729683349522d396992e59c37dc377d9aa.css integrity="sha256-fZX1aQgici7DtHs7/fIjcpaDNJUi05aZLlnDfcN32ao=" rel="preload stylesheet" as=style><link rel=apple-touch-icon href=https://brunoluiz.net/apple-touch-icon.png><link rel=icon href=https://brunoluiz.net/favicon.ico><meta name=generator content="Hugo 0.75.1"><meta property="og:title" content="A guide on npm package publishing"><meta property="og:description" content="If you are not new in the JavaScript world, you might have already heard about npm. It is a package manager which lets developers easily add dependencies to projects, as npm install hello-world. But, have you ever asked, How do I create and publish my own packages"><meta property="og:type" content="article"><meta property="og:url" content="https://brunoluiz.net/blog/2019/feb/a-guide-to-npm-package-publishing/"><meta property="og:image" content="https://brunoluiz.net/blog/2019/feb/a-guide-to-npm-package-publishing/cover.jpg"><meta property="article:published_time" content="2019-02-15T19:44:37+00:00"><meta property="article:modified_time" content="2019-02-15T19:44:37+00:00"><meta property="og:site_name" content="Bruno Luiz Silva"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://brunoluiz.net/blog/2019/feb/a-guide-to-npm-package-publishing/cover.jpg"><meta name=twitter:title content="A guide on npm package publishing"><meta name=twitter:description content="If you are not new in the JavaScript world, you might have already heard about npm. It is a package manager which lets developers easily add dependencies to projects, as npm install hello-world. But, have you ever asked, How do I create and publish my own packages"><meta itemprop=name content="A guide on npm package publishing"><meta itemprop=description content="If you are not new in the JavaScript world, you might have already heard about npm. It is a package manager which lets developers easily add dependencies to projects, as npm install hello-world. But, have you ever asked, How do I create and publish my own packages"><meta itemprop=datePublished content="2019-02-15T19:44:37+00:00"><meta itemprop=dateModified content="2019-02-15T19:44:37+00:00"><meta itemprop=wordCount content="1372"><meta itemprop=image content="https://brunoluiz.net/blog/2019/feb/a-guide-to-npm-package-publishing/cover.jpg"><meta itemprop=keywords content></head><body class=single id=top><script>if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><header class=header><nav class=nav><p class=logo><a href=https://brunoluiz.net>Bruno Luiz Silva</a></p><ul class=menu id=menu onscroll=menu_on_scroll()></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>A guide on npm package publishing</h1><div class=post-meta><time>February 15, 2019</time>&nbsp;·&nbsp;7 min</div></header><div class=post-content><p><img loading=lazy src=cover.jpg alt="Photo by Paul Esch-Laurent on Unsplash"></p><p>If you are not new in the JavaScript world, you might have already heard about <a href=https://www.npmjs.com/>npm</a>. It is a package manager which lets developers easily add dependencies to projects, as <code>npm install hello-world</code>. But, have you ever asked, &ldquo;How do I create and publish my own packages&rdquo;?</p><h2 id=how-a-package-is-composed>How a package is composed?</h2><p>Packages are quite simple to create in JavaScript. A <code>package.json</code> and <code>index.js</code> can already do the job. Look at <code>dedupe</code> for example:</p><p><img loading=lazy src=dedupe.png alt="dedupe repository"></p><p>There are other useful files such as <code>.gitignore</code>, <code>.npmignore</code>, <code>LICENSE</code> and <code>README.md</code>, but the main ones are there: <code>package.json</code> and <code>index.js</code>. Having these, the package just needs to be published in a repository, such as the <a href=https://www.npmjs.com/>npm public</a>. Through this guide, you will be able to have a simple package published on npm.</p><h2 id=create-an-npm-package>Create an npm package</h2><p>While doing <a href=https://apimock.in>apimock.in</a>, I had to create multiple serverless stacks. Each had error handlers and, as most of the errors are quite the same, a good practice would be to extract these definitions into a package and just install it on each serverless stack. This use case will be used as an example through this post.</p><h3 id=create-an-npmjscom-account>Create an npmjs.com account</h3><p>Before doing anything, an account on <a href=https://npmjs.com>npmjs.com</a> is required for publishing a package. This is the website for the npm public repository, used when <code>npm install ...</code> is executed.</p><p>To create an account, go to the <a href=https://www.npmjs.com/signup>npm signup page</a> and fill up the form. After finishing the process, a test can be done using <code>npm login</code> and <code>npm whoami</code>. Has it output your username? Great! It is working!</p><h3 id=some-words-about-scopes>Some words about scopes</h3><p>Scopes are useful in many ways, although not strictly required to publish an npm package. Every user has its own scope, defined as the npm user name.</p><p>As only the developer/company can publish to its own scope, it is quite useful to indicate it is an official package. For example, one can publish a package called <code>xyz-sdk</code>, but another called <code>xyz</code> might already exist. How to know which to install? What if <code>xyz</code> mimics <code>xyz-sdk</code>, but with malicious code?</p><blockquote><p>Each npm user/organisation has their own scope, and only you can add packages in your scope. This means you don’t have to worry about someone taking your package name ahead of you. Thus it is also a good way to signal official packages for organisations. (<a href=https://docs.npmjs.com/misc/scope>from npm-scopes documentation</a>)</p></blockquote><p>A scoped package would have an <code>@account</code> prefix. It would be published as <code>@account/xyz-sdk</code>, hence easily identifiable as from a specific developer. Besides, the developer doesn&rsquo;t have to worry about name clashing, as the scope is account specific. It can be configured to point to a private repository as well, making it especially useful for companies.</p><p>There is <a href=https://docs.npmjs.com/misc/scope>more information about scopes here</a>. Keep in mind it is a good practice to scope packages.</p><h3 id=create-a-simple-structure>Create a simple structure</h3><p>In an empty folder, run <code>npm init —-scope=@your-npm-user</code>. This will setup a <code>package.json</code> and ask for some information, such as name, version, main entry file and author. The end result will be something like the following.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;@brunoluiz/jsonapi-errors&#34;</span>,
  <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;1.0.0&#34;</span>,
  <span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;JSONAPI Common Errors&#34;</span>,
  <span style=color:#f92672>&#34;main&#34;</span>: <span style=color:#e6db74>&#34;index.js&#34;</span>,
  <span style=color:#f92672>&#34;scripts&#34;</span>: {
    <span style=color:#f92672>&#34;test&#34;</span>: <span style=color:#e6db74>&#34;jest&#34;</span>
  },
  <span style=color:#f92672>&#34;author&#34;</span>: <span style=color:#e6db74>&#34;Bruno Luiz da Silva &lt;contact@brunoluiz.net&gt; (http://brunoluiz.net/)&#34;</span>,
  <span style=color:#f92672>&#34;license&#34;</span>: <span style=color:#e6db74>&#34;MIT&#34;</span>
}
</code></pre></div><p>After having it initialised, is time to code something. Develop a basic implementation of it in the specified main file on <code>npm init</code> setup (usually <code>index.js</code>). If the package requires dependencies or there are files to be ignored on publishing, specify it on a <code>.gitignore</code> file (eg: <code>node_modules</code>).</p><p>It is suggested to add a <code>LICENSE.md</code> and a <code>README.md</code>, as other developers might use this package. Usually, MIT or ISC licenses are fine to open-source projects, but <a href=https://choosealicense.com/>choosealicense.com</a> can help on choosing another license.</p><h3 id=publish-the-package>Publish the package</h3><p>The basic implementation is done and now is time to deploy it! On the first time, a <code>npm publish --access=public</code> is required. The <code>access=public</code> param is needed because scoped are <code>restricted</code> by default. On following publishings, a <code>npm publish</code> will do the job.</p><p>Congratulations! You published your first package on npm. It should be available at <code>https://npmjs.com/package/@your-npm-user/package-name</code> and ready to be installed through <code>npm install @your-npm-user/package-name</code>.</p><p><img loading=lazy src=npm_published_module.png alt="Published package"></p><h3 id=releasing-new-versions>Releasing new versions</h3><p>After some iterations, the package might need new features and, therefore a new version. NPM packages use semantic versioning (<a href=https://semver.org/>SEMVER</a>), but in a nutshell:</p><blockquote><p>MAJOR version when you make incompatible API changes,</p><p>MINOR version when you add functionality in a backwards-compatible manner, and</p><p>PATCH version when you make backwards-compatible bug fixes.</p></blockquote><p>In the <code>jsonapi-errors</code> example, a minor version increment is required. To do this, a <code>npm version minor</code> can be used, where it will bump the <code>package.json</code> version and add a tagged git commit. Then, a <code>npm publish</code> will take care of pushing it (no need for <code>access</code> parameter now). The version tags can be checked using <code>git log --decorate --oneline</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>b874866 <span style=color:#f92672>(</span>HEAD -&gt; master, tag: v0.2.0<span style=color:#f92672>)</span> 0.2.0
c5af2df chore: add new implementations
b8571cc <span style=color:#f92672>(</span>tag: v0.1.0<span style=color:#f92672>)</span> 0.1.0
c5bf2ef chore: initial commit
</code></pre></div><p>There are <a href=https://docs.npmjs.com/cli/version.html>more information about the versioning process here</a>.</p><h3 id=using-in-local-projects-through-linking>Using in local projects through linking</h3><p>A simple way to test the new shiny package is through <code>npm install</code>. It will work as expected but, if a change is required, a new version has to be published and the project dependency has to be upgraded to use the new one.</p><p>This is unproductive, especially when a package is new and changes happen quite often. A way to solve it is through <code>npm link</code>: it creates a symbolic link inside the project <code>node_modules</code> folder, replacing the installed version with the local one.</p><p>In the module folder, run <code>npm link</code>, which will enable a global link for it. On the project folder, run <code>npm link &lt;name></code>. If the module is modified, projects using it through a link will have the latest version of it.</p><p>After testing, two steps are required to remove it. The first is running <code>npm unlink --no-save &lt;name></code>, which removes the link from the project without touching <code>package.json</code>. The second is <code>npm install</code>, as the module is removed from <code>node_modules</code> after unlinking.</p><p>Removing the global link is not required, especially because it can be used later. If still needed, a <code>npm unlink</code> in the module folder will do it.</p><h2 id=automate-publishing-process-using-circleci>Automate publishing process using CircleCI</h2><p>If a package has many people collaborating to it, or the deploy process requires extra steps beside publishing it, an automated setup can improve the workflow. There are plenty of options, such as CircleCI, Travis and GitLab CI.</p><p>On CircleCI Blog there is an <a href=https://circleci.com/blog/publishing-npm-packages-using-circleci-2-0/>article explaining in details how to do it</a>, where:</p><ol><li>On feature branches, it will just run tests (eg: run tests on pull requests)</li><li>On git <code>v*.*.*</code> tag pushes, it will run tests and then publish to the NPM repository — remembering, a git version tag is generated by <code>npm version</code></li></ol><p>More configurations can be added, such as saving coverage reports to a bucket or triggering specific web hooks after the jobs (eg: Slack).</p><h2 id=setup-default-npm-init-configs>Setup default npm init configs</h2><p>Starting a package with <code>npm init</code> is fine, but repeating the same information over and over can get quite boring. <code>npm config</code> can be used to setup some default configs:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm config set init-author-name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Bruno Luiz da Silva&#39;</span>
npm config set init-author-email<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;contact@brunoluiz.net&#39;</span>
npm config set init-author-url<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;https://brunoluiz.net&#39;</span>
npm config set init-license<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;MIT&#39;</span>
</code></pre></div><p>These are saved at <code>~/.npmrc</code>, together with other user configs.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># ~/.npmrc</span>

init-author-name<span style=color:#f92672>=</span>Bruno Luiz da Silva
init-author-email<span style=color:#f92672>=</span>contact@brunoluiz.net
init-author-url<span style=color:#f92672>=</span>http://brunoluiz.net/
init-version<span style=color:#f92672>=</span>1.0.0
...
</code></pre></div><p>Now, a simple <code>npm init -y</code> can be used to create packages. It will not ask for user input, using the npm configs instead and <code>@&lt;scope>/&lt;folder-name></code> as the name.</p><p>There are many other configs available through it. Besides, projects can have their own specific configs and even environment variables can be used for it. Check <a href=https://docs.npmjs.com/misc/config>the npm documentation</a> for more details.</p><h2 id=where-to-go-now>Where to go now?</h2><p>The steps shown in this article will cover most basic necessities on npm package publishing, but there are some specifics I haven&rsquo;t covered in this article.</p><ol><li><strong>Publish the package as TypeScript:</strong> this allows code typing, more robust codes and, in editors such as VS Code, it enables a batter IntelliSense. <a href=https://itnext.io/step-by-step-building-and-publishing-an-npm-typescript-package-44fe7164964c>There is a quite complete article on
ITNext</a>.</li><li><strong>Publish it to a private repository:</strong> there are some small different configurations, as pointing the package scope to the private repository. <a href=https://docs.npmjs.com/creating-and-publishing-private-packages>Give a look in this npm article</a>.</li></ol></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://brunoluiz.net>Bruno Luiz Silva</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo️️</a>️</span>
<span>&#183;</span>
<span>Theme️ <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top"><button class=top-link id=top-link type=button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6"><path d="M12 6H0l6-6z"/></svg></button></a>
<script src=https://brunoluiz.net/js/highlight.min.min.e7afc2928c0925d65c4732dfebe147014d91299a98e819e4b42f25c4fa68e91c.js integrity="sha256-56/CkowJJdZcRzLf6+FHAU2RKZqY6BnktC8lxPpo6Rw="></script><script>hljs.initHighlightingOnLoad();</script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();document.querySelector(this.getAttribute("href")).scrollIntoView({behavior:"smooth"});});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script data-goatcounter=https://brunoluiz.goatcounter.com/count async src=//gc.zgo.at/count.js></script></body></html>